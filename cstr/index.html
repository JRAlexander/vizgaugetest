<html>

<head>
    <script type="text/javascript" src="./src/gauge.js"> </script>
    <script language="JavaScript">
        /*
         * Copyright: Microsoft 2019
         *
         * An example visualizer for use with CSTR simulators.
         */
        const svgns = "http://www.w3.org/2000/svg";
        const params = new URLSearchParams(window.location.search);
        const darkMode = params.get("_theme") === "dark";
        const debug = params.get("debug") === "true";

        // set on load()

        const crgauge = undefined;
        const trgauge = undefined;
        const tcgauge = undefined;

        // utility setAttributes
        function setAttributes(el, attributes) {
            for (var attr in attributes) el.setAttribute(attr, attributes[attr]);
        }

        // setup the document
        function setup() {
            svgDoc = document.getElementById("imported-svg").contentDocument;
            if (svgDoc) {
                try {
                    crgauge = Gauge(
                        document.getElementById("cr_gauge"),
                        {
                            min: -0.1,
                            max: 12,
                            dialStartAngle: 180,
                            dialEndAngle: 0,
                            value: 0,
                            viewBox: "0 0 100 57",
                            color: function (value) {
                                if (value < 20) {
                                    return "#5ee432";
                                } else if (value < 40) {
                                    return "#fffa50";
                                } else if (value < 60) {
                                    return "#f7aa38";
                                } else {
                                    return "#ef4655";
                                }
                            }
                        }
                    );

                    trgauge = Gauge(
                        document.getElementById("tr_gauge"),
                        {
                            min: 10,
                            max: 800,
                            dialStartAngle: 180,
                            dialEndAngle: 0,
                            value: 0,
                            viewBox: "0 0 100 57",
                            color: function (value) {
                                if (value < 200) {
                                    return "#5ee432";
                                } else if (value < 400) {
                                    return "#fffa50";
                                } else if (value < 600) {
                                    return "#f7aa38";
                                } else {
                                    return "#ef4655";
                                }
                            }
                        }
                    );

                    tcgauge = Gauge(
                        document.getElementById("tc_gauge"),
                        {
                            min: 10,
                            max: 800,
                            dialStartAngle: 180,
                            dialEndAngle: 0,
                            value: 297.9798,
                            viewBox: "0 0 100 57",
                            color: function (value) {
                                if (value < 200) {
                                    return "#5ee432";
                                } else if (value < 400) {
                                    return "#fffa50";
                                } else if (value < 600) {
                                    return "#f7aa38";
                                } else {
                                    return "#ef4655";
                                }
                            }
                        }
                    );

                    // adjust our colors based upon theme.
                    if (darkMode) {
                        document.body.style.backgroundColor = "#333";
                        document.body.style.color = "white";
                    }
                } catch (e) {
                    // ignore
                }
            }
            // loading text
            if (debug) {
                const out = document.getElementById("out");
                out.textContent = "Waiting...";
            }
        }

        // update the visualization from state and action data
        function update(data) {
            // convert message to formatted JSON text for display
            const str = JSON.stringify(data, null, 2);

            //  if (debug) {
            const out = document.getElementById("out");
            out.textContent = str.Cr;
            // }
            svgDoc = document.getElementById("imported-svg").contentDocument;
            if (svgDoc) {
                try {
                    // update positions of graphical elements
                    // Cr : product specific residual concentration mixture of A and B
                    const Cr = data.state[Cr].value;
                    const Tr = data.state[Tr].value;
                    const Tc = data.state[Tc].value;
                    crgauge = Gauge(
                        document.getElementById("cr_gauge"),
                        {
                            min: -0.1,
                            max: 12,
                            dialStartAngle: 180,
                            dialEndAngle: 0,
                            value: 0,
                            viewBox: "0 0 100 57",
                            color: function (value) {
                                if (value < 20) {
                                    return "#5ee432";
                                } else if (value < 40) {
                                    return "#fffa50";
                                } else if (value < 60) {
                                    return "#f7aa38";
                                } else {
                                    return "#ef4655";
                                }
                            }
                        }
                    );

                    trgauge = Gauge(
                        document.getElementById("tr_gauge"),
                        {
                            min: 10,
                            max: 800,
                            dialStartAngle: 180,
                            dialEndAngle: 0,
                            value: 0,
                            viewBox: "0 0 100 57",
                            color: function (value) {
                                if (value < 200) {
                                    return "#5ee432";
                                } else if (value < 400) {
                                    return "#fffa50";
                                } else if (value < 600) {
                                    return "#f7aa38";
                                } else {
                                    return "#ef4655";
                                }
                            }
                        }
                    );

                    tcgauge = Gauge(
                        document.getElementById("tc_gauge"),
                        {
                            min: 10,
                            max: 800,
                            dialStartAngle: 180,
                            dialEndAngle: 0,
                            value: 0,
                            viewBox: "0 0 100 57",
                            color: function (value) {
                                if (value < 200) {
                                    return "#5ee432";
                                } else if (value < 400) {
                                    return "#fffa50";
                                } else if (value < 600) {
                                    return "#f7aa38";
                                } else {
                                    return "#ef4655";
                                }
                            }
                        }
                    );
                    //const tankLevelElem = svgDoc.getElementById("cr_gauge");
                    crgauge.setValueAnimated(Cr, 3);

                    trgauge.setValueAnimated(Tr, 3);

                    tcgauge.setValueAnimated(Tc, 3);
                } catch (e) {
                    // ignore
                }
            }
        }
        function init() {
            // on load
            window.addEventListener("load", () => {
                setup();
            });

            // on message
            window.addEventListener(
                "message",
                (event) => {
                    const data = JSON.parse(event.data);
                    update(data);
                },
                false
            );
        }
    </script>
</head>

<body>
    <pre id="out" style="font-size: x-small; display: box; position: absolute"></pre>
    <p>
        Residual Concentration (Cr):
    <div class="display">
        <div id="cr_gauge" class="gauge-container two"></div>
    </div>
    </p>
    <p>
        Reactor Temperature (Tr):
    <div class="display">
        <div id="tr_gauge" class="gauge-container two"></div>
    </div>
    </p>
    <p>
        Reactor cooling jacket coolant temperature (Tc):
    <div class="display">
        <div id="tc_gauge" class="gauge-container two"></div>
    </div>
    </p>
    <object data="simpleTank.svg" type="image/svg+xml" id="imported-svg" width="100%" height="100%"></object>
    <script language="JavaScript">
        init();
    </script>
</body>

</html>